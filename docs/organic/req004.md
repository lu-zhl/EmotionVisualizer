# Req 004

## Milestone

The name for this milestone is `004-mood-visualization-backend`

## Backend for Mood Visualization

### Overview

Implement backend API endpoint to generate mood visualization images using Google Gemini API. The endpoint accepts mood input from the frontend (free text and/or selected emotions) and returns a generated abstract image.

### API Endpoint

**POST /api/v1/visualizations/generate**

Request body:
```json
{
  "free_text": "I feel overwhelmed with work but also excited about the project",
  "feeling_category": "not_sure",
  "selected_emotions": ["cozy", "content", "fuming"]
}
```

At least one of `free_text` or `selected_emotions` must be provided.

Response:
```json
{
  "success": true,
  "data": {
    "image_url": "...",
    "prompt_used": "..."
  }
}
```

### Image Generation Requirements

1. **API**: Google Gemini API (Imagen)
2. **Style**: Abstract art style
3. **Color**: Low saturation, muted/pastel tones
4. **Composition**: Symmetrical or balanced
5. **No text**: Generated images should not contain any text or letters

### Prompt Engineering

The backend should:
1. Take the input (free text + emotions)
2. Construct a prompt that guides Gemini to generate an abstract mood visualization
3. Include style constraints in the prompt (abstract, low saturation, no text, symmetrical)

### Authentication

- MVP: Anonymous access allowed (no authentication required)
- Future: Will add user authentication and history tracking

### Storage (MVP)

- For MVP/mocking: Use local file system or return base64 encoded image
- Future suggestion needed from coder

### Error Handling

- Handle Gemini API failures gracefully
- Return appropriate error messages to frontend
- Timeout handling for slow generation

### Future Enhancements (not in this milestone)

- Mood intensity levels (e.g., "slightly sad", "very happy")
- User authentication and visualization history
- Rate limiting per user
- Cloud storage for generated images
